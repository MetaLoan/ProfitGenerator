# 服务管理脚本说明

## 📋 可用脚本

项目提供了三个便捷的服务管理脚本：

| 脚本 | 功能 | 说明 |
|------|------|------|
| `restart.sh` | 重启服务 | 停止当前服务并重新启动 |
| `start.sh` | 启动服务 | 启动服务（如果已运行会提示） |
| `stop.sh` | 停止服务 | 停止运行中的服务 |

## 🚀 使用方法

### 方法 1：一键重启（推荐）

```bash
cd /Users/leo/Desktop/create
./restart.sh
```

**功能**：
- ✅ 自动停止现有服务
- ✅ 检查端口释放
- ✅ 重新启动服务
- ✅ 验证启动状态
- ✅ 显示健康检查结果

### 方法 2：分别启动/停止

```bash
# 启动服务
./start.sh

# 停止服务
./stop.sh
```

## 📝 详细说明

### restart.sh - 一键重启

**使用场景**：
- 修改代码后需要重启服务
- 服务出现问题时重启
- 部署新版本时

**执行流程**：
1. 停止现有服务
2. 检查端口释放
3. 启动新服务
4. 验证启动状态
5. 显示服务信息

**示例输出**：
```
🔄 重启 ETH 晒单收益模拟 API
==================================

1️⃣  停止现有服务...
   🛑 找到进程 PID: 12345
   ✅ 已停止服务
   ⏳ 等待进程退出...

2️⃣  检查端口状态...
   ✅ 端口 3070 已释放

3️⃣  切换到项目目录...
   📁 当前目录: /Users/leo/Desktop/create

4️⃣  启动服务...
   🚀 启动中...
   ⏳ 等待服务启动...

5️⃣  验证服务状态...
   ✅ 服务启动成功！

==================================
✨ 重启完成

📍 服务信息：
   本地地址: http://localhost:3070
   进程 PID: 12346
   日志文件: /Users/leo/Desktop/create/server.log

📊 健康状态：
   {
     "status": "healthy",
     "browser": "running",
     "port": 3070
   }
```

### start.sh - 启动服务

**使用场景**：
- 首次启动服务
- 服务停止后重新启动

**特点**：
- 如果服务已运行，会提示并退出
- 自动检查端口占用
- 启动后验证服务状态

### stop.sh - 停止服务

**使用场景**：
- 需要停止服务
- 准备重启服务

**特点**：
- 自动查找并停止进程
- 强制清理残留进程
- 验证停止状态

## 🔧 手动操作

如果脚本无法使用，可以手动操作：

### 查看服务状态

```bash
# 检查端口占用
lsof -ti:3070

# 查看进程
ps aux | grep "node server.js"
```

### 手动停止服务

```bash
# 停止服务
lsof -ti:3070 | xargs kill -9

# 或者使用进程 ID
kill -9 <PID>
```

### 手动启动服务

```bash
cd /Users/leo/Desktop/create
node server.js
```

### 后台运行服务

```bash
cd /Users/leo/Desktop/create
nohup node server.js > server.log 2>&1 &
```

## 📊 服务监控

### 查看日志

```bash
# 实时查看日志
tail -f server.log

# 查看最后 50 行
tail -50 server.log

# 搜索错误
grep -i error server.log
```

### 健康检查

```bash
# 检查服务健康状态
curl http://localhost:3070/api/health

# 格式化输出
curl -s http://localhost:3070/api/health | python3 -m json.tool
```

### 测试 API

```bash
# 测试生成图片
curl "http://localhost:3070/api/generate?tradepair=ETHUSDT&opendate=2025-12-02%2017:20&date=2025-12-03%2017:20&direction=long&lev=50"
```

## ⚠️ 常见问题

### 1. 权限不足

```bash
# 添加执行权限
chmod +x restart.sh start.sh stop.sh
```

### 2. 端口被占用但找不到进程

```bash
# 强制清理端口
sudo lsof -ti:3070 | xargs kill -9
```

### 3. 服务启动失败

检查日志：
```bash
tail -50 server.log
```

常见原因：
- 端口被占用
- 依赖未安装
- 代码错误

### 4. 浏览器相关问题

如果出现浏览器错误：
- 服务会自动重启浏览器
- 查看日志了解详细信息
- 可以重启服务尝试解决

## 🎯 最佳实践

1. **修改代码后**：使用 `./restart.sh` 重启服务
2. **服务异常时**：先查看日志 `tail -f server.log`，然后重启
3. **部署前**：确保服务健康检查通过
4. **定期检查**：使用健康检查端点监控服务状态

## 📞 快速命令参考

```bash
# 重启服务（最常用）
./restart.sh

# 查看日志
tail -f server.log

# 健康检查
curl http://localhost:3070/api/health

# 停止服务
./stop.sh

# 启动服务
./start.sh
```



