<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ™’å•å›¾ API æµ‹è¯•å·¥å…·</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&family=Noto+Sans+SC:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-primary: #0a0a0f;
      --bg-secondary: #12121a;
      --bg-tertiary: #1a1a24;
      --border-color: #2a2a3a;
      --text-primary: #e8e8ec;
      --text-secondary: #8888a0;
      --accent-green: #10b981;
      --accent-red: #ef4444;
      --accent-blue: #3b82f6;
      --accent-purple: #8b5cf6;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Noto Sans SC', -apple-system, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
      line-height: 1.6;
    }
    
    .app {
      display: grid;
      grid-template-columns: 380px 1fr;
      min-height: 100vh;
    }
    
    /* å·¦ä¾§å‚æ•°é¢æ¿ */
    .params-panel {
      background: var(--bg-secondary);
      border-right: 1px solid var(--border-color);
      padding: 24px;
      overflow-y: auto;
      max-height: 100vh;
    }
    
    .panel-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid var(--border-color);
    }
    
    .panel-header h1 {
      font-size: 18px;
      font-weight: 600;
      background: linear-gradient(135deg, var(--accent-green), var(--accent-blue));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .panel-header .badge {
      font-size: 11px;
      padding: 2px 8px;
      background: var(--accent-purple);
      border-radius: 4px;
      color: #fff;
    }
    
    /* æœåŠ¡å™¨é…ç½® */
    .server-config {
      background: var(--bg-tertiary);
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 20px;
    }
    
    .server-config label {
      font-size: 11px;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .server-config input {
      width: 100%;
      margin-top: 6px;
      padding: 8px 12px;
      background: var(--bg-primary);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      color: var(--text-primary);
      font-family: 'JetBrains Mono', monospace;
      font-size: 13px;
    }
    
    /* å‚æ•°åˆ†ç»„ */
    .param-group {
      margin-bottom: 20px;
    }
    
    .param-group-title {
      font-size: 12px;
      font-weight: 500;
      color: var(--text-secondary);
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .param-group-title::before {
      content: '';
      width: 3px;
      height: 14px;
      background: var(--accent-blue);
      border-radius: 2px;
    }
    
    .param-row {
      margin-bottom: 12px;
    }
    
    .param-row label {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 13px;
      margin-bottom: 4px;
      color: var(--text-primary);
    }
    
    .param-row label .required {
      color: var(--accent-red);
      font-size: 10px;
    }
    
    .param-row label .optional {
      color: var(--text-secondary);
      font-size: 10px;
    }
    
    .param-row input,
    .param-row select {
      width: 100%;
      padding: 10px 12px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      color: var(--text-primary);
      font-size: 13px;
      transition: border-color 0.2s, box-shadow 0.2s;
    }
    
    .param-row input:focus,
    .param-row select:focus {
      outline: none;
      border-color: var(--accent-blue);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }
    
    .param-row input::placeholder {
      color: var(--text-secondary);
    }
    
    .param-hint {
      font-size: 11px;
      color: var(--text-secondary);
      margin-top: 4px;
    }
    
    /* åŒåˆ—å¸ƒå±€ */
    .param-row-double {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    
    /* å¼€å…³æ ·å¼ */
    .switch-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 0;
    }
    
    .switch-row label {
      margin-bottom: 0;
    }
    
    .switch {
      position: relative;
      width: 44px;
      height: 24px;
    }
    
    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    
    .switch-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--bg-tertiary);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      transition: 0.3s;
    }
    
    .switch-slider::before {
      position: absolute;
      content: '';
      height: 18px;
      width: 18px;
      left: 2px;
      bottom: 2px;
      background: var(--text-secondary);
      border-radius: 50%;
      transition: 0.3s;
    }
    
    .switch input:checked + .switch-slider {
      background: var(--accent-green);
      border-color: var(--accent-green);
    }
    
    .switch input:checked + .switch-slider::before {
      transform: translateX(20px);
      background: #fff;
    }
    
    /* æŒ‰é’® */
    .btn-generate {
      width: 100%;
      padding: 14px;
      background: linear-gradient(135deg, var(--accent-green), #059669);
      border: none;
      border-radius: 8px;
      color: #fff;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: transform 0.2s, box-shadow 0.2s;
      margin-top: 20px;
    }
    
    .btn-generate:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 20px rgba(16, 185, 129, 0.3);
    }
    
    .btn-generate:active {
      transform: translateY(0);
    }
    
    .btn-generate:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    .btn-generate .spinner {
      width: 18px;
      height: 18px;
      border: 2px solid rgba(255,255,255,0.3);
      border-top-color: #fff;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* å³ä¾§ç»“æœé¢æ¿ */
    .result-panel {
      display: flex;
      flex-direction: column;
      background: var(--bg-primary);
      overflow: hidden;
    }
    
    .result-header {
      padding: 16px 24px;
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border-color);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .result-tabs {
      display: flex;
      gap: 4px;
    }
    
    .result-tab {
      padding: 8px 16px;
      background: transparent;
      border: none;
      border-radius: 6px;
      color: var(--text-secondary);
      font-size: 13px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .result-tab.active {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }
    
    .result-tab:hover:not(.active) {
      color: var(--text-primary);
    }
    
    .result-actions {
      display: flex;
      gap: 8px;
    }
    
    .btn-action {
      padding: 8px 12px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      color: var(--text-primary);
      font-size: 12px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .btn-action:hover {
      background: var(--border-color);
    }
    
    .result-content {
      flex: 1;
      overflow: auto;
      padding: 24px;
    }
    
    /* å›¾ç‰‡é¢„è§ˆ */
    .image-preview {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 400px;
    }
    
    .image-preview.empty {
      color: var(--text-secondary);
    }
    
    .image-preview .placeholder {
      text-align: center;
    }
    
    .image-preview .placeholder-icon {
      font-size: 48px;
      margin-bottom: 16px;
      opacity: 0.5;
    }
    
    .preview-image {
      max-width: 100%;
      max-height: calc(100vh - 200px);
      border-radius: 8px;
      box-shadow: 0 4px 30px rgba(0,0,0,0.5);
    }
    
    .image-info {
      margin-top: 16px;
      padding: 12px 16px;
      background: var(--bg-secondary);
      border-radius: 8px;
      font-size: 12px;
      color: var(--text-secondary);
      display: flex;
      gap: 20px;
    }
    
    .image-info span {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    /* JSON é¢„è§ˆ */
    .json-preview {
      display: none;
    }
    
    .json-preview.active {
      display: block;
    }
    
    .json-content {
      background: var(--bg-secondary);
      border-radius: 8px;
      padding: 16px;
      overflow: auto;
      max-height: calc(100vh - 200px);
    }
    
    .json-content pre {
      font-family: 'JetBrains Mono', monospace;
      font-size: 12px;
      line-height: 1.6;
      white-space: pre-wrap;
      word-break: break-all;
    }
    
    /* çŠ¶æ€ä¿¡æ¯ */
    .status-bar {
      padding: 12px 24px;
      background: var(--bg-secondary);
      border-top: 1px solid var(--border-color);
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 12px;
      color: var(--text-secondary);
    }
    
    .status-bar .status {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--text-secondary);
    }
    
    .status-dot.success {
      background: var(--accent-green);
    }
    
    .status-dot.error {
      background: var(--accent-red);
    }
    
    .status-dot.loading {
      background: var(--accent-blue);
      animation: pulse 1s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    /* é”™è¯¯æç¤º */
    .error-message {
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid var(--accent-red);
      border-radius: 8px;
      padding: 16px;
      color: var(--accent-red);
    }
    
    .error-message h3 {
      font-size: 14px;
      margin-bottom: 8px;
    }
    
    .error-message p {
      font-size: 13px;
      opacity: 0.9;
    }
    
    /* æˆåŠŸæ¶ˆæ¯ */
    .success-message {
      background: rgba(16, 185, 129, 0.1);
      border: 1px solid var(--accent-green);
      border-radius: 8px;
      padding: 12px 16px;
      color: var(--accent-green);
      font-size: 13px;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    /* å¿«æ·å¡«å…… */
    .quick-fill {
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px solid var(--border-color);
    }
    
    .quick-fill-title {
      font-size: 11px;
      color: var(--text-secondary);
      margin-bottom: 8px;
    }
    
    .quick-fill-btns {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }
    
    .btn-quick {
      padding: 6px 10px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border-color);
      border-radius: 4px;
      color: var(--text-secondary);
      font-size: 11px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .btn-quick:hover {
      background: var(--border-color);
      color: var(--text-primary);
    }
    
    /* å“åº”å¼ */
    @media (max-width: 900px) {
      .app {
        grid-template-columns: 1fr;
      }
      
      .params-panel {
        max-height: none;
        border-right: none;
        border-bottom: 1px solid var(--border-color);
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- å·¦ä¾§å‚æ•°é¢æ¿ -->
    <div class="params-panel">
      <div class="panel-header">
        <h1>ğŸš€ æ™’å•å›¾ API æµ‹è¯•</h1>
        <span class="badge">v2.0</span>
      </div>
      
      <!-- æœåŠ¡å™¨é…ç½® -->
      <div class="server-config">
        <label>API æœåŠ¡å™¨åœ°å€</label>
        <input type="text" id="serverUrl" value="https://api.bitcoin-agent.online" placeholder="https://api.bitcoin-agent.online">
      </div>
      
      <!-- åŸºç¡€å‚æ•° -->
      <div class="param-group">
        <div class="param-group-title">åŸºç¡€å‚æ•°</div>
        
        <div class="param-row">
          <label>äº¤æ˜“æ‰€ <span class="optional">å¯é€‰</span></label>
          <input type="text" id="ex" value="lbanken" placeholder="lbanken">
        </div>
        
        <div class="param-row">
          <label>äº¤æ˜“å¯¹ <span class="required">å¿…å¡«</span></label>
          <input type="text" id="tradepair" value="ETHUSDT" placeholder="ETHUSDT">
        </div>
        
        <div class="param-row-double">
          <div class="param-row">
            <label>å¼€ä»“æ—¶é—´ <span class="required">å¿…å¡«</span></label>
            <input type="text" id="opendate" placeholder="2025-12-01 10:00">
          </div>
          <div class="param-row">
            <label>æ˜¾ç¤ºæ—¶é—´ <span class="required">å¿…å¡«</span></label>
            <input type="text" id="date" placeholder="2025-12-03 18:00">
          </div>
        </div>
        <div class="param-hint">æ ¼å¼: YYYY-MM-DD HH:mm</div>
      </div>
      
      <!-- äº¤æ˜“å‚æ•° -->
      <div class="param-group">
        <div class="param-group-title">äº¤æ˜“å‚æ•°</div>
        
        <div class="param-row-double">
          <div class="param-row">
            <label>æ–¹å‘</label>
            <select id="direction">
              <option value="long">åšå¤š (Long)</option>
              <option value="short">åšç©º (Short)</option>
            </select>
          </div>
          <div class="param-row">
            <label>æ æ†å€æ•°</label>
            <input type="number" id="lev" value="50" min="1" max="500" placeholder="50">
          </div>
        </div>
        
        <div class="param-row">
          <label>æ–¹å‘åŠ¨ä½œ <span class="optional">å¯é€‰</span></label>
          <select id="direction_action">
            <option value="">æ— ï¼ˆé»˜è®¤ï¼‰</option>
            <option value="open">å¼€ä»“ (Open)</option>
            <option value="close">å¹³ä»“ (Close)</option>
          </select>
          <div class="param-hint">ç”¨äºæ˜¾ç¤º "å¼€å¤š/å¹³ç©º" ç­‰æ–‡æ¡ˆ</div>
        </div>
      </div>
      
      <!-- é«˜çº§é€‰é¡¹ -->
      <div class="param-group">
        <div class="param-group-title">é«˜çº§é€‰é¡¹</div>
        
        <div class="param-row">
          <label>æ—¶åŒº <span class="optional">å¯é€‰</span></label>
          <select id="timezone">
            <option value="+8">UTC+8 åŒ—äº¬/é¦™æ¸¯</option>
            <option value="+9">UTC+9 ä¸œäº¬/é¦–å°”</option>
            <option value="+7">UTC+7 æ›¼è°·/é›…åŠ è¾¾</option>
            <option value="+5.5">UTC+5:30 å°åº¦</option>
            <option value="+3">UTC+3 è«æ–¯ç§‘</option>
            <option value="+1">UTC+1 å·´é»/æŸæ—</option>
            <option value="+0">UTC+0 ä¼¦æ•¦</option>
            <option value="-5">UTC-5 çº½çº¦</option>
            <option value="-8">UTC-8 æ´›æ‰çŸ¶</option>
          </select>
          <div class="param-hint">è°ƒæ•´å›¾ç‰‡ä¸Šæ˜¾ç¤ºçš„æ—¶é—´æ‰€å±æ—¶åŒº</div>
        </div>
        
        <div class="switch-row">
          <label>å¯ç”¨åŠ¨æ€æ–¹å‘å˜è‰²</label>
          <label class="switch">
            <input type="checkbox" id="dynamic_direction_color" checked>
            <span class="switch-slider"></span>
          </label>
        </div>
        <div class="param-hint">æ ¹æ®æ–¹å‘è‡ªåŠ¨è®¾ç½®é¢œè‰²ï¼ˆå¼€å¤š/å¹³ç©º=ç»¿ï¼Œå¼€ç©º/å¹³å¤š=çº¢ï¼‰</div>
      </div>
      
      <!-- äºŒç»´ç å‚æ•° -->
      <div class="param-group">
        <div class="param-group-title">ğŸ“± äºŒç»´ç å‚æ•°</div>
        
        <div class="param-row">
          <label>é‚€è¯·ç  <span class="optional">å¯é€‰</span></label>
          <input type="text" id="refcode" placeholder="ç•™ç©ºä½¿ç”¨é»˜è®¤å€¼">
          <div class="param-hint">
            Easicoin é»˜è®¤: HAJIMI â†’ https://www.easicoinx.com/account/register/?inviteCode=HAJIMI<br>
            LBanken é»˜è®¤: 5NCXS â†’ https://lbank.com/ref/5NCXS
          </div>
        </div>
      </div>
      
      <!-- ç”ŸæˆæŒ‰é’® -->
      <button class="btn-generate" id="generateBtn" onclick="generateImage()">
        <span>âš¡</span>
        <span>ç”Ÿæˆæ™’å•å›¾</span>
      </button>
      
      <!-- å¿«æ·å¡«å…… -->
      <div class="quick-fill">
        <div class="quick-fill-title">âš¡ å¿«æ·å¡«å……</div>
        <div class="quick-fill-btns">
          <button class="btn-quick" onclick="fillQuick('yesterday')">æ˜¨å¤©å¼€ä»“</button>
          <button class="btn-quick" onclick="fillQuick('week')">ä¸€å‘¨å‰</button>
          <button class="btn-quick" onclick="fillQuick('month')">ä¸€æœˆå‰</button>
          <button class="btn-quick" onclick="fillQuick('random')">éšæœºå‚æ•°</button>
          <button class="btn-quick" onclick="clearCache()" style="background: var(--accent-red); color: #fff; border-color: var(--accent-red);">ğŸ—‘ï¸ æ¸…é™¤ç¼“å­˜</button>
        </div>
        <div class="param-hint" style="margin-top: 8px;">ğŸ’¾ å‚æ•°ä¼šè‡ªåŠ¨ä¿å­˜ï¼Œä¸‹æ¬¡æ‰“å¼€è‡ªåŠ¨æ¢å¤</div>
      </div>
      
      <!-- API å‚æ•°è¯´æ˜ -->
      <div class="param-docs" style="margin-top: 20px; padding-top: 16px; border-top: 1px solid var(--border-color);">
        <div class="param-group-title" style="cursor: pointer;" onclick="toggleDocs()">
          ğŸ“– API å‚æ•°è¯´æ˜ <span id="docsToggle" style="font-size: 10px; opacity: 0.6;">â–¼</span>
        </div>
        <div id="docsContent" style="display: none; font-size: 11px; line-height: 1.8; color: var(--text-secondary); margin-top: 12px;">
          <table style="width: 100%; border-collapse: collapse;">
            <tr style="border-bottom: 1px solid var(--border-color);">
              <td style="padding: 6px 0; color: var(--accent-blue); font-family: 'JetBrains Mono', monospace;">ex</td>
              <td style="padding: 6px 0;">äº¤æ˜“æ‰€IDï¼Œé»˜è®¤ <code style="background: var(--bg-tertiary); padding: 1px 4px; border-radius: 3px;">easicoin</code>ï¼Œå¯é€‰ <code style="background: var(--bg-tertiary); padding: 1px 4px; border-radius: 3px;">lbanken</code></td>
            </tr>
            <tr style="border-bottom: 1px solid var(--border-color);">
              <td style="padding: 6px 0; color: var(--accent-red); font-family: 'JetBrains Mono', monospace;">tradepair *</td>
              <td style="padding: 6px 0;">äº¤æ˜“å¯¹ï¼Œå¦‚ <code style="background: var(--bg-tertiary); padding: 1px 4px; border-radius: 3px;">ETHUSDT</code>ã€<code style="background: var(--bg-tertiary); padding: 1px 4px; border-radius: 3px;">BTCUSDT</code></td>
            </tr>
            <tr style="border-bottom: 1px solid var(--border-color);">
              <td style="padding: 6px 0; color: var(--accent-red); font-family: 'JetBrains Mono', monospace;">opendate *</td>
              <td style="padding: 6px 0;">å¼€ä»“æ—¶é—´ï¼Œæ ¼å¼ <code style="background: var(--bg-tertiary); padding: 1px 4px; border-radius: 3px;">YYYY-MM-DD HH:mm</code></td>
            </tr>
            <tr style="border-bottom: 1px solid var(--border-color);">
              <td style="padding: 6px 0; color: var(--accent-red); font-family: 'JetBrains Mono', monospace;">date *</td>
              <td style="padding: 6px 0;">æ˜¾ç¤ºæ—¶é—´ï¼ˆç”¨äºè®¡ç®—æ”¶ç›Šï¼‰ï¼Œæ ¼å¼åŒä¸Š</td>
            </tr>
            <tr style="border-bottom: 1px solid var(--border-color);">
              <td style="padding: 6px 0; color: var(--accent-blue); font-family: 'JetBrains Mono', monospace;">direction</td>
              <td style="padding: 6px 0;"><code style="background: var(--bg-tertiary); padding: 1px 4px; border-radius: 3px;">long</code> åšå¤š | <code style="background: var(--bg-tertiary); padding: 1px 4px; border-radius: 3px;">short</code> åšç©º</td>
            </tr>
            <tr style="border-bottom: 1px solid var(--border-color);">
              <td style="padding: 6px 0; color: var(--accent-blue); font-family: 'JetBrains Mono', monospace;">lev</td>
              <td style="padding: 6px 0;">æ æ†å€æ•°ï¼Œé»˜è®¤ <code style="background: var(--bg-tertiary); padding: 1px 4px; border-radius: 3px;">10</code></td>
            </tr>
            <tr style="border-bottom: 1px solid var(--border-color);">
              <td style="padding: 6px 0; color: var(--accent-blue); font-family: 'JetBrains Mono', monospace;">direction_action</td>
              <td style="padding: 6px 0;"><code style="background: var(--bg-tertiary); padding: 1px 4px; border-radius: 3px;">open</code> å¼€ä»“ | <code style="background: var(--bg-tertiary); padding: 1px 4px; border-radius: 3px;">close</code> å¹³ä»“</td>
            </tr>
            <tr style="border-bottom: 1px solid var(--border-color);">
              <td style="padding: 6px 0; color: var(--accent-blue); font-family: 'JetBrains Mono', monospace;">timezone</td>
              <td style="padding: 6px 0;">æ—¶åŒºåç§»ï¼Œå¦‚ <code style="background: var(--bg-tertiary); padding: 1px 4px; border-radius: 3px;">+8</code>ã€<code style="background: var(--bg-tertiary); padding: 1px 4px; border-radius: 3px;">-5</code>ï¼Œé»˜è®¤ +8</td>
            </tr>
            <tr style="border-bottom: 1px solid var(--border-color);">
              <td style="padding: 6px 0; color: var(--accent-purple); font-family: 'JetBrains Mono', monospace;">dynamic_direction_color</td>
              <td style="padding: 6px 0;"><code style="background: var(--bg-tertiary); padding: 1px 4px; border-radius: 3px;">true</code> å¯ç”¨æ–¹å‘åŠ¨æ€å˜è‰²</td>
            </tr>
            <tr>
              <td style="padding: 6px 0; color: var(--accent-green); font-family: 'JetBrains Mono', monospace;">refcode</td>
              <td style="padding: 6px 0;">é‚€è¯·ç ï¼Œç”¨äºç”ŸæˆäºŒç»´ç é“¾æ¥ã€‚Easicoin é»˜è®¤ <code style="background: var(--bg-tertiary); padding: 1px 4px; border-radius: 3px;">HAJIMI</code>ï¼ŒLBanken é»˜è®¤ <code style="background: var(--bg-tertiary); padding: 1px 4px; border-radius: 3px;">5NCXS</code></td>
            </tr>
          </table>
          
          <div style="margin-top: 12px; padding: 10px; background: var(--bg-tertiary); border-radius: 6px;">
            <div style="color: var(--accent-green); margin-bottom: 6px;">ğŸ¨ åŠ¨æ€å˜è‰²è§„åˆ™ï¼š</div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 4px;">
              <span>â€¢ å¼€å¤š (open_long) â†’ <span style="color: #10b981;">ç»¿è‰²</span></span>
              <span>â€¢ å¼€ç©º (open_short) â†’ <span style="color: #ef4444;">çº¢è‰²</span></span>
              <span>â€¢ å¹³å¤š (close_long) â†’ <span style="color: #ef4444;">çº¢è‰²</span></span>
              <span>â€¢ å¹³ç©º (close_short) â†’ <span style="color: #10b981;">ç»¿è‰²</span></span>
            </div>
          </div>
          
          <div style="margin-top: 12px; padding: 10px; background: var(--bg-tertiary); border-radius: 6px;">
            <div style="color: var(--accent-blue); margin-bottom: 6px;">ğŸ“ ç¤ºä¾‹è¯·æ±‚ï¼š</div>
            <code style="font-size: 10px; word-break: break-all; color: var(--text-secondary);">
              /api/generate?ex=lbanken&tradepair=ETHUSDT&opendate=2025-12-03 15:00&date=2025-12-04 14:00&direction=long&lev=50&direction_action=open&dynamic_direction_color=true&refcode=MYCODE
            </code>
          </div>
          
          <div style="margin-top: 12px; padding: 10px; background: var(--bg-tertiary); border-radius: 6px;">
            <div style="color: var(--accent-green); margin-bottom: 6px;">ğŸ“± äºŒç»´ç é“¾æ¥æ ¼å¼ï¼š</div>
            <div style="display: grid; gap: 4px;">
              <span>â€¢ Easicoin: <code style="font-size: 10px; color: var(--text-secondary);">https://www.easicoinx.com/account/register/?inviteCode={refcode}</code></span>
              <span>â€¢ LBanken: <code style="font-size: 10px; color: var(--text-secondary);">https://lbank.com/ref/{refcode}</code></span>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- å³ä¾§ç»“æœé¢æ¿ -->
    <div class="result-panel">
      <div class="result-header">
        <div class="result-tabs">
          <button class="result-tab active" onclick="switchTab('image')">ğŸ–¼ï¸ å›¾ç‰‡é¢„è§ˆ</button>
          <button class="result-tab" onclick="switchTab('json')">ğŸ“„ JSON æ•°æ®</button>
        </div>
        <div class="result-actions">
          <button class="btn-action" onclick="downloadImage()" id="downloadBtn" style="display:none;">
            â¬‡ï¸ ä¸‹è½½å›¾ç‰‡
          </button>
          <button class="btn-action" onclick="copyJson()" id="copyBtn" style="display:none;">
            ğŸ“‹ å¤åˆ¶ JSON
          </button>
        </div>
      </div>
      
      <div class="result-content">
        <!-- å›¾ç‰‡é¢„è§ˆ -->
        <div class="image-preview empty" id="imagePreview">
          <div class="placeholder">
            <div class="placeholder-icon">ğŸ–¼ï¸</div>
            <p>å¡«å†™å‚æ•°åç‚¹å‡»ã€Œç”Ÿæˆæ™’å•å›¾ã€</p>
            <p style="font-size: 12px; margin-top: 8px; opacity: 0.7;">æ”¯æŒ ETHUSDTã€BTCUSDT ç­‰äº¤æ˜“å¯¹</p>
          </div>
        </div>
        
        <!-- JSON é¢„è§ˆ -->
        <div class="json-preview" id="jsonPreview">
          <div class="json-content">
            <pre id="jsonContent">// è¯·æ±‚è¿”å›çš„ JSON æ•°æ®å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</pre>
          </div>
        </div>
      </div>
      
      <div class="status-bar">
        <div class="status">
          <span class="status-dot" id="statusDot"></span>
          <span id="statusText">å‡†å¤‡å°±ç»ª</span>
        </div>
        <div id="requestTime"></div>
      </div>
    </div>
  </div>
  
  <script>
    // çŠ¶æ€
    let currentResult = null;
    let currentTab = 'image';
    const CACHE_KEY = 'api_test_params_v1';
    
    // åˆå§‹åŒ–ï¼šæ¢å¤ç¼“å­˜æˆ–è®¾ç½®é»˜è®¤æ—¶é—´
    window.addEventListener('DOMContentLoaded', () => {
      if (!loadCachedParams()) {
        fillQuick('yesterday');
      }
    });
    
    // ä¿å­˜å‚æ•°åˆ° localStorage
    function saveParams() {
      const params = {
        serverUrl: document.getElementById('serverUrl').value,
        ex: document.getElementById('ex').value,
        tradepair: document.getElementById('tradepair').value,
        opendate: document.getElementById('opendate').value,
        date: document.getElementById('date').value,
        direction: document.getElementById('direction').value,
        lev: document.getElementById('lev').value,
        direction_action: document.getElementById('direction_action').value,
        timezone: document.getElementById('timezone').value,
        dynamic_direction_color: document.getElementById('dynamic_direction_color').checked,
        refcode: document.getElementById('refcode').value,
        savedAt: new Date().toISOString()
      };
      localStorage.setItem(CACHE_KEY, JSON.stringify(params));
    }
    
    // ä» localStorage åŠ è½½å‚æ•°
    function loadCachedParams() {
      try {
        const cached = localStorage.getItem(CACHE_KEY);
        if (!cached) return false;
        
        const params = JSON.parse(cached);
        
        // æ¢å¤å„å­—æ®µ
        if (params.serverUrl) document.getElementById('serverUrl').value = params.serverUrl;
        if (params.ex) document.getElementById('ex').value = params.ex;
        if (params.tradepair) document.getElementById('tradepair').value = params.tradepair;
        if (params.opendate) document.getElementById('opendate').value = params.opendate;
        if (params.date) document.getElementById('date').value = params.date;
        if (params.direction) document.getElementById('direction').value = params.direction;
        if (params.lev) document.getElementById('lev').value = params.lev;
        if (params.direction_action) document.getElementById('direction_action').value = params.direction_action;
        if (params.timezone) document.getElementById('timezone').value = params.timezone;
        if (params.dynamic_direction_color !== undefined) {
          document.getElementById('dynamic_direction_color').checked = params.dynamic_direction_color;
        }
        if (params.refcode) document.getElementById('refcode').value = params.refcode;
        
        console.log('âœ… å·²æ¢å¤ä¸Šæ¬¡å‚æ•°ï¼Œä¿å­˜äº:', params.savedAt);
        return true;
      } catch (e) {
        console.warn('åŠ è½½ç¼“å­˜å‚æ•°å¤±è´¥:', e);
        return false;
      }
    }
    
    // æ¸…é™¤ç¼“å­˜
    function clearCache() {
      localStorage.removeItem(CACHE_KEY);
      fillQuick('yesterday');
      alert('âœ… å·²æ¸…é™¤ç¼“å­˜ï¼Œå‚æ•°å·²é‡ç½®');
    }
    
    // å¿«æ·å¡«å……
    function fillQuick(type) {
      const now = new Date();
      let openDate, closeDate;
      
      switch (type) {
        case 'yesterday':
          openDate = new Date(now.getTime() - 24 * 60 * 60 * 1000);
          closeDate = new Date(now.getTime() - 60 * 60 * 1000);
          break;
        case 'week':
          openDate = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
          closeDate = new Date(now.getTime() - 60 * 60 * 1000);
          break;
        case 'month':
          openDate = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
          closeDate = new Date(now.getTime() - 60 * 60 * 1000);
          break;
        case 'random':
          const randomDays = Math.floor(Math.random() * 30) + 1;
          openDate = new Date(now.getTime() - randomDays * 24 * 60 * 60 * 1000);
          closeDate = new Date(now.getTime() - 60 * 60 * 1000);
          document.getElementById('lev').value = Math.floor(Math.random() * 150) + 10;
          document.getElementById('direction').value = Math.random() > 0.5 ? 'long' : 'short';
          break;
      }
      
      document.getElementById('opendate').value = formatDateTime(openDate);
      document.getElementById('date').value = formatDateTime(closeDate);
    }
    
    function formatDateTime(date) {
      const y = date.getFullYear();
      const m = String(date.getMonth() + 1).padStart(2, '0');
      const d = String(date.getDate()).padStart(2, '0');
      const h = String(date.getHours()).padStart(2, '0');
      const min = String(date.getMinutes()).padStart(2, '0');
      return `${y}-${m}-${d} ${h}:${min}`;
    }
    
    // ç”Ÿæˆå›¾ç‰‡
    async function generateImage() {
      const btn = document.getElementById('generateBtn');
      const statusDot = document.getElementById('statusDot');
      const statusText = document.getElementById('statusText');
      const requestTime = document.getElementById('requestTime');
      
      // è·å–å‚æ•°
      const serverUrl = document.getElementById('serverUrl').value.trim();
      const params = {
        ex: document.getElementById('ex').value.trim(),
        tradepair: document.getElementById('tradepair').value.trim(),
        opendate: document.getElementById('opendate').value.trim(),
        date: document.getElementById('date').value.trim(),
        direction: document.getElementById('direction').value,
        lev: document.getElementById('lev').value,
        direction_action: document.getElementById('direction_action').value,
        timezone: document.getElementById('timezone').value,
        dynamic_direction_color: document.getElementById('dynamic_direction_color').checked,
        refcode: document.getElementById('refcode').value.trim()
      };
      
      // éªŒè¯å¿…å¡«å‚æ•°
      if (!params.tradepair || !params.opendate || !params.date) {
        alert('è¯·å¡«å†™å¿…å¡«å‚æ•°ï¼šäº¤æ˜“å¯¹ã€å¼€ä»“æ—¶é—´ã€æ˜¾ç¤ºæ—¶é—´');
        return;
      }
      
      // ä¿å­˜å‚æ•°åˆ°ç¼“å­˜
      saveParams();
      
      // æ„å»º URL
      const urlParams = new URLSearchParams();
      if (params.ex) urlParams.set('ex', params.ex);
      urlParams.set('tradepair', params.tradepair);
      urlParams.set('opendate', params.opendate);
      urlParams.set('date', params.date);
      urlParams.set('direction', params.direction);
      urlParams.set('lev', params.lev);
      if (params.direction_action) urlParams.set('direction_action', params.direction_action);
      if (params.timezone && params.timezone !== '+8') urlParams.set('timezone', params.timezone);
      if (params.dynamic_direction_color) urlParams.set('dynamic_direction_color', 'true');
      if (params.refcode) urlParams.set('refcode', params.refcode);
      
      const url = `${serverUrl}/api/generate?${urlParams.toString()}`;
      
      // æ›´æ–° UI çŠ¶æ€
      btn.disabled = true;
      btn.innerHTML = '<span class="spinner"></span><span>ç”Ÿæˆä¸­...</span>';
      statusDot.className = 'status-dot loading';
      statusText.textContent = 'æ­£åœ¨è¯·æ±‚...';
      requestTime.textContent = '';
      
      const startTime = Date.now();
      
      try {
        const response = await fetch(url, {
          headers: {
            'ngrok-skip-browser-warning': 'true'
          }
        });
        
        const elapsed = Date.now() - startTime;
        requestTime.textContent = `è€—æ—¶: ${elapsed}ms`;
        
        const result = await response.json();
        currentResult = result;
        
        if (result.success) {
          // æˆåŠŸ
          statusDot.className = 'status-dot success';
          statusText.textContent = `æˆåŠŸ - ${result.tradeInfo?.yield || ''}`;
          
          showImageResult(result);
          showJsonResult(result);
          
          document.getElementById('downloadBtn').style.display = 'block';
          document.getElementById('copyBtn').style.display = 'block';
        } else {
          // å¤±è´¥
          statusDot.className = 'status-dot error';
          statusText.textContent = 'ç”Ÿæˆå¤±è´¥';
          
          showError(result.message || result.error || 'æœªçŸ¥é”™è¯¯');
          showJsonResult(result);
          
          document.getElementById('downloadBtn').style.display = 'none';
          document.getElementById('copyBtn').style.display = 'block';
        }
        
      } catch (error) {
        const elapsed = Date.now() - startTime;
        requestTime.textContent = `è€—æ—¶: ${elapsed}ms`;
        
        statusDot.className = 'status-dot error';
        statusText.textContent = 'è¯·æ±‚å¤±è´¥';
        
        showError(`è¯·æ±‚å¤±è´¥: ${error.message}\n\nè¯·ç¡®ä¿ API æœåŠ¡å·²å¯åŠ¨ (node server.js)`);
        
        document.getElementById('downloadBtn').style.display = 'none';
        document.getElementById('copyBtn').style.display = 'none';
      } finally {
        btn.disabled = false;
        btn.innerHTML = '<span>âš¡</span><span>ç”Ÿæˆæ™’å•å›¾</span>';
      }
    }
    
    // æ˜¾ç¤ºå›¾ç‰‡ç»“æœ
    function showImageResult(result) {
      const preview = document.getElementById('imagePreview');
      const width = result.data?.width || 908;
      const height = result.data?.height || 1280;
      const refcode = result.tradeInfo?.ref || '-';
      const qrcodeUrl = result.tradeInfo?.qrcode_url || '';
      
      preview.className = 'image-preview';
      preview.innerHTML = `
        <div class="success-message">
          âœ… ${result.message}
        </div>
        <img src="${result.data.image}" class="preview-image" alt="æ™’å•å›¾">
        <div class="image-info">
          <span>ğŸ“ å°ºå¯¸: ${width} Ã— ${height}</span>
          <span>ğŸ“Š äº¤æ˜“å¯¹: ${result.tradepair?.display || '-'}</span>
          <span>ğŸ’° æ”¶ç›Š: ${result.tradeInfo?.yield || '-'}</span>
          <span>ğŸ“ˆ æ æ†: ${result.tradeInfo?.leverage}x</span>
        </div>
        ${qrcodeUrl ? `
        <div class="image-info" style="margin-top: 8px;">
          <span>ğŸ“± é‚€è¯·ç : <strong>${refcode}</strong></span>
          <span style="flex: 2;">ğŸ”— äºŒç»´ç é“¾æ¥: <a href="${qrcodeUrl}" target="_blank" style="color: var(--accent-blue);">${qrcodeUrl}</a></span>
        </div>
        ` : ''}
      `;
    }
    
    // æ˜¾ç¤ºé”™è¯¯
    function showError(message) {
      const preview = document.getElementById('imagePreview');
      preview.className = 'image-preview';
      preview.innerHTML = `
        <div class="error-message">
          <h3>âŒ ç”Ÿæˆå¤±è´¥</h3>
          <p>${message}</p>
        </div>
      `;
    }
    
    // æ˜¾ç¤º JSON ç»“æœ
    function showJsonResult(result) {
      const content = document.getElementById('jsonContent');
      content.textContent = JSON.stringify(result, null, 2);
    }
    
    // åˆ‡æ¢æ ‡ç­¾
    function switchTab(tab) {
      currentTab = tab;
      
      document.querySelectorAll('.result-tab').forEach(t => t.classList.remove('active'));
      event.target.classList.add('active');
      
      document.getElementById('imagePreview').style.display = tab === 'image' ? 'flex' : 'none';
      document.getElementById('jsonPreview').style.display = tab === 'json' ? 'block' : 'none';
      document.getElementById('jsonPreview').classList.toggle('active', tab === 'json');
    }
    
    // ä¸‹è½½å›¾ç‰‡
    function downloadImage() {
      if (!currentResult?.data?.image) return;
      
      const a = document.createElement('a');
      a.href = currentResult.data.image;
      a.download = `${currentResult.tradepair?.symbol || 'trade'}-${Date.now()}.png`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    }
    
    // å¤åˆ¶ JSON
    function copyJson() {
      if (!currentResult) return;
      
      const text = JSON.stringify(currentResult, null, 2);
      navigator.clipboard.writeText(text).then(() => {
        const btn = document.getElementById('copyBtn');
        btn.textContent = 'âœ… å·²å¤åˆ¶';
        setTimeout(() => {
          btn.textContent = 'ğŸ“‹ å¤åˆ¶ JSON';
        }, 2000);
      });
    }
    
    // é”®ç›˜å¿«æ·é”®
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && (e.metaKey || e.ctrlKey)) {
        generateImage();
      }
    });
    
    // è‡ªåŠ¨ä¿å­˜ï¼šç›‘å¬è¾“å…¥å˜åŒ–
    const inputIds = ['serverUrl', 'ex', 'tradepair', 'opendate', 'date', 'direction', 'lev', 'direction_action', 'timezone', 'dynamic_direction_color', 'refcode'];
    inputIds.forEach(id => {
      const el = document.getElementById(id);
      if (el) {
        el.addEventListener('change', saveParams);
        if (el.type === 'text' || el.type === 'number') {
          el.addEventListener('input', debounce(saveParams, 500));
        }
      }
    });
    
    // é˜²æŠ–å‡½æ•°
    function debounce(fn, delay) {
      let timer;
      return function(...args) {
        clearTimeout(timer);
        timer = setTimeout(() => fn.apply(this, args), delay);
      };
    }
    
    // åˆ‡æ¢å‚æ•°æ–‡æ¡£æ˜¾ç¤º
    function toggleDocs() {
      const content = document.getElementById('docsContent');
      const toggle = document.getElementById('docsToggle');
      if (content.style.display === 'none') {
        content.style.display = 'block';
        toggle.textContent = 'â–²';
      } else {
        content.style.display = 'none';
        toggle.textContent = 'â–¼';
      }
    }
  </script>
</body>
</html>


